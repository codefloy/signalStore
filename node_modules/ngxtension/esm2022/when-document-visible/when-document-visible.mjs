import { injectDocumentVisibilityStream, } from 'ngxtension/inject-document-visibility';
import { partition, repeat, takeUntil, } from 'rxjs';
/**
 * RxJS operator to pause a stream when the document is hidden (i.e.: tab is not active)
 * and to resume the stream when the document is visible (i.e.: tab is active).
 *
 * @example This example shows how to do an HTTP GET every 5 seconds only when the page is visible in the browser:
 * ```typescript
 * http.get('http://api').pipe(poll(5000), whenPageVisible()).subscribe(result => {})
 * ```
 * @public
 */
export function whenDocumentVisible(options) {
    const visibilityChanged$ = injectDocumentVisibilityStream(options);
    const [pageVisible$, pageHidden$] = partition(visibilityChanged$, () => {
        return document.visibilityState === 'visible';
    });
    return (source) => {
        return source.pipe(takeUntil(pageHidden$), repeat({ delay: () => pageVisible$ }));
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2hlbi1kb2N1bWVudC12aXNpYmxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vbGlicy9uZ3h0ZW5zaW9uL3doZW4tZG9jdW1lbnQtdmlzaWJsZS9zcmMvd2hlbi1kb2N1bWVudC12aXNpYmxlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTiw4QkFBOEIsR0FDOUIsTUFBTSx1Q0FBdUMsQ0FBQztBQUMvQyxPQUFPLEVBR04sU0FBUyxFQUNULE1BQU0sRUFDTixTQUFTLEdBQ1QsTUFBTSxNQUFNLENBQUM7QUFFZDs7Ozs7Ozs7O0dBU0c7QUFDSCxNQUFNLFVBQVUsbUJBQW1CLENBQ2xDLE9BQXlDO0lBRXpDLE1BQU0sa0JBQWtCLEdBQUcsOEJBQThCLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDbkUsTUFBTSxDQUFDLFlBQVksRUFBRSxXQUFXLENBQUMsR0FBRyxTQUFTLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ3RFLE9BQU8sUUFBUSxDQUFDLGVBQWUsS0FBSyxTQUFTLENBQUM7SUFDL0MsQ0FBQyxDQUFDLENBQUM7SUFDSCxPQUFPLENBQUMsTUFBcUIsRUFBRSxFQUFFO1FBQ2hDLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FDakIsU0FBUyxDQUFDLFdBQVcsQ0FBQyxFQUN0QixNQUFNLENBQUMsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxFQUFFLENBQUMsQ0FDckMsQ0FBQztJQUNILENBQUMsQ0FBQztBQUNILENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuXHRJbmplY3REb2N1bWVudFZpc2liaWxpdHlPcHRpb25zLFxuXHRpbmplY3REb2N1bWVudFZpc2liaWxpdHlTdHJlYW0sXG59IGZyb20gJ25neHRlbnNpb24vaW5qZWN0LWRvY3VtZW50LXZpc2liaWxpdHknO1xuaW1wb3J0IHtcblx0TW9ub1R5cGVPcGVyYXRvckZ1bmN0aW9uLFxuXHRPYnNlcnZhYmxlLFxuXHRwYXJ0aXRpb24sXG5cdHJlcGVhdCxcblx0dGFrZVVudGlsLFxufSBmcm9tICdyeGpzJztcblxuLyoqXG4gKiBSeEpTIG9wZXJhdG9yIHRvIHBhdXNlIGEgc3RyZWFtIHdoZW4gdGhlIGRvY3VtZW50IGlzIGhpZGRlbiAoaS5lLjogdGFiIGlzIG5vdCBhY3RpdmUpXG4gKiBhbmQgdG8gcmVzdW1lIHRoZSBzdHJlYW0gd2hlbiB0aGUgZG9jdW1lbnQgaXMgdmlzaWJsZSAoaS5lLjogdGFiIGlzIGFjdGl2ZSkuXG4gKlxuICogQGV4YW1wbGUgVGhpcyBleGFtcGxlIHNob3dzIGhvdyB0byBkbyBhbiBIVFRQIEdFVCBldmVyeSA1IHNlY29uZHMgb25seSB3aGVuIHRoZSBwYWdlIGlzIHZpc2libGUgaW4gdGhlIGJyb3dzZXI6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBodHRwLmdldCgnaHR0cDovL2FwaScpLnBpcGUocG9sbCg1MDAwKSwgd2hlblBhZ2VWaXNpYmxlKCkpLnN1YnNjcmliZShyZXN1bHQgPT4ge30pXG4gKiBgYGBcbiAqIEBwdWJsaWNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHdoZW5Eb2N1bWVudFZpc2libGU8VD4oXG5cdG9wdGlvbnM/OiBJbmplY3REb2N1bWVudFZpc2liaWxpdHlPcHRpb25zLFxuKTogTW9ub1R5cGVPcGVyYXRvckZ1bmN0aW9uPFQ+IHtcblx0Y29uc3QgdmlzaWJpbGl0eUNoYW5nZWQkID0gaW5qZWN0RG9jdW1lbnRWaXNpYmlsaXR5U3RyZWFtKG9wdGlvbnMpO1xuXHRjb25zdCBbcGFnZVZpc2libGUkLCBwYWdlSGlkZGVuJF0gPSBwYXJ0aXRpb24odmlzaWJpbGl0eUNoYW5nZWQkLCAoKSA9PiB7XG5cdFx0cmV0dXJuIGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PT0gJ3Zpc2libGUnO1xuXHR9KTtcblx0cmV0dXJuIChzb3VyY2U6IE9ic2VydmFibGU8VD4pID0+IHtcblx0XHRyZXR1cm4gc291cmNlLnBpcGUoXG5cdFx0XHR0YWtlVW50aWwocGFnZUhpZGRlbiQpLFxuXHRcdFx0cmVwZWF0KHsgZGVsYXk6ICgpID0+IHBhZ2VWaXNpYmxlJCB9KSxcblx0XHQpO1xuXHR9O1xufVxuIl19